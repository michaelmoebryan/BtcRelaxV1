<?phpnamespace BtcRelax;use BtcRelax\Dao\BookmarkSearchCriteria;use BtcRelax\SecureSession;use BtcRelax\Utils;use BtcRelax\Validation\BookmarkValidator;               global $core;                        $status = $core->getSessionState();    $cUser = $core->getUser();        switch ($status)    {        case SecureSession::STATUS_ROOT:            $header = new LayoutHeader($cUser);            break;        case SecureSession::STATUS_USER:            break;        case SecureSession::STATUS_GUEST:            Utils::redirect('guest');            break;        default:            Utils::redirect('main');            break;         }    $currentOrder = $core->getCurrentOrder();    /* @var $core type */    $om = $core->getOM();    if ($currentOrder === null)    {        $activeOrder = $om->getOrdersByUser($cUser,true);        if (FALSE !== $activeOrder)        {            $core->setCurrentOrder($activeOrder);            $currentOrder = $activeOrder;        }        else         {            $selectedBookmark = $core->getSelectedBookmark();            if ($selectedBookmark != null)            {                $currentOrder = $om->createNewOrder($cUser, $selectedBookmark );                if ($currentOrder != null)                {                    $core->setCurrentOrder($currentOrder);                }            }        }        }        if (array_key_exists("isConfirmed", $extra))    {        $isOrderConfirmed = filter_var($extra["isConfirmed"], FILTER_VALIDATE_BOOLEAN);        if ($isOrderConfirmed === false)        {            // first parameter is null by default, and its mean that variable             // must be cleared            $core->setCurrentOrder();        }        else        {            $registerResult = $om->tryConfirmOrder($currentOrder);            if (FALSE === $registerResult)                {                    $core->setCurrentOrder($currentOrder);                }            else            {                $core->setCurrentOrder($registerResult);            }        }          }        function actionGetActiveBookmarks() {                        $dao = new BookmarkDao();                        $status = BookmarkValidator::validateStatus('Published');                        $search = (new BookmarkSearchCriteria())->setStatus($status);                        $bookmarksList = $dao->find($search);                        return $bookmarksList;    }        function renderGetActiveBookmarks() {        $result = "";        $bList = actionGetActiveBookmarks();        if (empty($bList))        {            $result = "<p>No active bookmarks now!</p>";        }        else        {            	//$result = '<div class="container"><div class="row" >';		$pLang = 'ru';                foreach ($bList as $curPoint) 		{                    $result  .= $curPoint->GetPublicForm($pLang);								 		}                //$result = $result .  '</div></div>';        }        return $result;    }    if ( !function_exists('sys_get_temp_dir')) {         function sys_get_temp_dir() {             if (!empty($_ENV['TMP'])) { return realpath($_ENV['TMP']); }             if (!empty($_ENV['TMPDIR'])) { return realpath( $_ENV['TMPDIR']); }             if (!empty($_ENV['TEMP'])) { return realpath( $_ENV['TEMP']); }             $tempfile=tempnam(__FILE__,'');             if (file_exists($tempfile)) {             unlink($tempfile);         return realpath(dirname($tempfile));         }     return null;   } } 